# 批量移动文件功能说明

## ✅ 已完成功能

### 🎯 核心功能

#### 1. **文件多选**
- ✅ 列表视图：复选框列（第一列）
- ✅ 卡片视图：左上角复选框
- ✅ 只能选择文件，文件夹不可选
- ✅ 全选/取消全选功能
- ✅ 选中状态视觉反馈

#### 2. **批量移动到上一级**
- ✅ 在文件夹内选中文件
- ✅ 点击"移动到上一级"按钮
- ✅ 一键移动所有选中文件到父目录
- ✅ 根目录不显示此按钮

#### 3. **批量移动到指定文件夹**
- ✅ 文件夹树形选择器
- ✅ 可视化选择目标文件夹
- ✅ 支持递归显示所有文件夹
- ✅ 选中状态提示

#### 4. **批量删除**
- ✅ 选中多个文件批量删除
- ✅ 确认对话框
- ✅ 显示删除进度
- ✅ 成功/失败统计

### 🎨 用户界面

#### **批量操作工具栏**
当选中文件后，自动显示渐变紫色工具栏：

```
┌─────────────────────────────────────────────────────────────┐
│ ☑️ 已选择 3 项  [移动到上一级] [移动到文件夹] [批量删除] [取消] │
└─────────────────────────────────────────────────────────────┘
```

**左侧区域：**
- 全选复选框
- 选中数量显示

**右侧区域：**
- 移动到上一级（仅在非根目录显示）
- 移动到文件夹
- 批量删除
- 取消选择

#### **列表视图**
```
┌──────────────────────────────────────────────────┐
│ ☑️ │ 文件名      │ 大小   │ 时间      │ 操作  │
├──────────────────────────────────────────────────┤
│ ☑️ │ 📄 报告.docx │ 2.5MB │ 2025-01-01│ ...   │
│ ☑️ │ 📷 照片.jpg  │ 1.2MB │ 2025-01-02│ ...   │
│    │ 📁 文件夹    │ -     │ 2025-01-03│ ...   │
└──────────────────────────────────────────────────┘
```

#### **卡片视图**
```
┌─────────┐ ┌─────────┐ ┌─────────┐
│ ☑️      │ │ ☑️ ✓    │ │         │
│ [图标]  │ │ [图标]  │ │ [文件夹]│
│ 文件名  │ │ 文件名  │ │ 文件夹  │
└─────────┘ └─────────┘ └─────────┘
  未选中      已选中        不可选
```

### 📖 使用方法

#### 方法1：移动到上一级目录

**步骤：**
1. 进入某个文件夹
2. 选中要移动的文件（复选框）
3. 点击"移动到上一级"按钮
4. 文件自动移动到父级目录

**示例场景：**
```
当前位置：根目录 > 文档 > 2024年报告
操作：选中 3 个文件 → 移动到上一级
结果：文件移动到"文档"文件夹
```

#### 方法2：移动到指定文件夹

**步骤：**
1. 选中要移动的文件（任意位置）
2. 点击"移动到文件夹"按钮
3. 在弹出的树形选择器中选择目标文件夹
4. 点击"确定移动"

**树形选择器示例：**
```
📁 根目录
  ├─ 📁 文档
  │   ├─ 📁 工作文档
  │   └─ 📁 个人文档
  ├─ 📁 图片
  │   ├─ 📁 照片
  │   └─ 📁 截图
  └─ 📁 视频
```

#### 方法3：批量删除

**步骤：**
1. 选中要删除的文件
2. 点击"批量删除"按钮
3. 确认删除
4. 等待删除完成

### 🔧 技术实现

#### 状态管理

**新增状态变量：**
```javascript
const selectedFiles = ref([])           // 选中的文件列表
const selectAll = ref(false)            // 全选状态
const showMoveDialog = ref(false)       // 移动对话框
const selectedTargetFolder = ref(null)  // 目标文件夹
const folderTreeRef = ref(null)         // 树组件引用
```

**计算属性：**
```javascript
isIndeterminate    // 全选半选状态
folderTreeData     // 文件夹树数据
```

#### 核心函数

**选择相关：**
```javascript
handleSelectionChange(selection)    // 表格选择变化
isSelectableRow(row)                // 判断行是否可选
isFileSelected(item)                // 判断文件是否选中
toggleFileSelection(item)           // 切换选中状态（卡片）
handleSelectAll(val)                // 全选/取消全选
clearSelection()                    // 清空选择
```

**移动相关：**
```javascript
moveToParent()                      // 移动到上一级
batchMoveFiles(targetFolderId)      // 批量移动文件
handleFolderNodeClick(data)         // 文件夹节点点击
confirmMoveToFolder()               // 确认移动
```

**删除相关：**
```javascript
batchDelete()                       // 批量删除
```

### 🎯 功能特点

#### 智能选择
- ✅ 只能选择文件，文件夹自动过滤
- ✅ 支持全选/半选/取消全选
- ✅ 列表和卡片视图选择状态同步

#### 批量操作
- ✅ 并发执行，提高效率
- ✅ 实时进度提示
- ✅ 成功/失败统计
- ✅ 错误处理和提示

#### 用户体验
- ✅ 操作工具栏动画效果
- ✅ 选中状态视觉反馈
- ✅ 确认对话框防误操作
- ✅ 一键取消选择

#### 性能优化
- ✅ 使用 `Promise.all` 并发处理
- ✅ 批量API调用
- ✅ 最小化重复渲染

### 💡 使用场景

#### 场景1：整理文件
```
问题：下载文件夹有很多临时文件需要移到归档文件夹
解决：选中所有临时文件 → 移动到归档文件夹
```

#### 场景2：从子文件夹提取文件
```
问题：需要把深层文件夹中的重要文件提取出来
解决：
1. 进入深层文件夹
2. 选中重要文件
3. 点击"移动到上一级"多次
或：直接选择根目录作为目标
```

#### 场景3：清理文件
```
问题：需要删除多个不需要的文件
解决：选中所有不需要的文件 → 批量删除
```

#### 场景4：重新分类
```
问题：照片文件夹中混有截图，需要分类
解决：
1. 选中所有截图
2. 移动到"截图"文件夹
```

### 🎨 视觉效果

#### 批量工具栏
- **颜色**：紫色渐变 (#667eea → #764ba2)
- **动画**：从上滑入（slideDown）
- **阴影**：柔和的紫色投影
- **按钮**：白色边框，半透明背景

#### 选中状态
- **列表视图**：复选框选中
- **卡片视图**：
  - 蓝色边框（2px solid #409EFF）
  - 蓝色投影
  - 左上角复选框选中

#### 移动对话框
- **树形结构**：文件夹图标 + 名称
- **选中提示**：绿色成功提示框
- **最大高度**：400px，超出滚动

### 📊 操作流程图

```
选中文件
    ↓
批量工具栏出现
    ↓
选择操作 → ┌─ 移动到上一级 → 确认 → 移动完成
           ├─ 移动到文件夹 → 选择 → 确认 → 移动完成
           └─ 批量删除 → 确认 → 删除完成
```

### 🔒 安全特性

1. **防误操作**：
   - 批量删除需要确认
   - 显示删除数量

2. **操作限制**：
   - 文件夹不能被选中
   - 根目录不显示"移动到上一级"

3. **错误处理**：
   - API失败捕获
   - 显示成功/失败统计
   - 部分失败不影响成功项

### 📦 依赖组件

**Element Plus：**
- `el-checkbox` - 复选框
- `el-button` - 按钮
- `el-button-group` - 按钮组
- `el-tag` - 标签
- `el-dialog` - 对话框
- `el-tree` - 树形控件
- `el-alert` - 警告提示
- `el-table-column type="selection"` - 表格复选框

### 🎉 核心优势

✅ **灵活性**：支持多种移动方式  
✅ **效率**：批量操作，并发执行  
✅ **可视化**：文件夹树形选择  
✅ **友好性**：丰富的视觉反馈  
✅ **安全性**：确认机制，防误操作  
✅ **智能性**：自动过滤文件夹  

## 🎯 总结

该功能完美解决了"从文件夹内移动文件到外面"的需求，并扩展支持：
- 移动到任意文件夹
- 批量操作
- 批量删除

用户可以通过简单的复选框选择和按钮点击，高效地管理和整理文件！
