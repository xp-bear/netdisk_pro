# 拖拽移动文件功能说明

## ✅ 已完成功能

### 1. 后端API
- **路由**: `PUT /api/files/:id/move`
- **功能**: 更新文件的`parent_id`，将文件移动到目标文件夹
- **文件**: `end/routes/files.js`

### 2. 前端API接口
- **方法**: `fileApi.moveFile(id, targetFolderId)`
- **文件**: `front/src/api/index.js`

### 3. Store状态管理
- **方法**: `fileStore.moveFile(fileId, targetFolderId)`
- **文件**: `front/src/stores/file.js`

### 4. UI交互功能
**文件**: `front/src/views/Home.vue`

#### 列表视图
- 文件行可拖拽（文件夹不可拖拽）
- 拖拽到文件夹上会显示高亮边框和提示标签
- 松开鼠标完成移动

#### 卡片视图
- 文件卡片可拖拽（文件夹不可拖拽）
- 拖拽到文件夹卡片上显示绿色遮罩层提示
- 拖拽中的文件卡片半透明显示
- 松开鼠标完成移动

## 🎨 视觉效果

### 拖拽状态
- **拖拽中**: 文件卡片/行半透明（opacity: 0.5）
- **悬停在文件夹**: 绿色虚线边框 + 绿色背景高亮
- **卡片视图遮罩**: 绿色半透明遮罩 + 文件夹图标 + 提示文字

### 动画效果
- 拖拽悬停动画（pulse脉冲效果）
- 平滑过渡动画
- 光标样式变化（grab → grabbing）

## 📖 使用方法

### 列表视图
1. 点击并按住文件行（文件名区域）
2. 拖动鼠标到目标文件夹行
3. 看到绿色高亮和"松开移动到此"提示
4. 松开鼠标完成移动

### 卡片视图
1. 点击并按住文件卡片
2. 拖动到目标文件夹卡片
3. 看到绿色遮罩和"松开移动到此文件夹"提示
4. 松开鼠标完成移动

## 💡 注意事项

1. **只有文件可以拖拽**，文件夹不可拖拽
2. **只能拖拽到文件夹**，不能拖拽到文件上
3. 移动成功后会显示成功提示消息
4. 移动失败会显示错误提示
5. 移动后页面自动刷新文件列表

## 🔧 技术实现

### HTML5拖放API
- `draggable` 属性控制元素是否可拖拽
- `dragstart` - 开始拖拽
- `dragover` - 拖拽经过（需preventDefault）
- `dragleave` - 离开目标区域
- `drop` - 放下文件
- `dragend` - 拖拽结束

### 状态管理
```javascript
const draggingFileId = ref(null)      // 正在拖拽的文件ID
const dragOverFolderId = ref(null)    // 鼠标悬停的文件夹ID
```

### 核心函数
- `handleDragStart(event, item)` - 开始拖拽
- `handleDragOver(event)` - 拖拽经过
- `handleDragLeave(event)` - 离开区域
- `handleDrop(event, folder)` - 放下文件
- `handleDragEnd(event)` - 拖拽结束

## 🎯 功能特点

✅ 支持列表和卡片两种视图模式  
✅ 实时视觉反馈（高亮、遮罩、提示）  
✅ 流畅的拖拽体验  
✅ 防止拖拽到非文件夹区域  
✅ 自动刷新文件列表  
✅ 友好的错误提示  

## 📦 相关文件

```
end/
  └── routes/files.js          # 后端移动文件API

front/src/
  ├── api/index.js             # 前端API接口
  ├── stores/file.js           # Pinia状态管理
  └── views/Home.vue           # 主界面组件（含拖拽逻辑）
```
